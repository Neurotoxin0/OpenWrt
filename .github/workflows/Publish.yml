name: Publish

on:  
  push:
    branches: 
      - master     

jobs:
  build:
    name: Publish
    runs-on: ubuntu-latest
    
    if: github.event.repository.owner.id == github.event.sender.id
    
    steps:

    - name: Clone Source Codes & Alter Feeds
      run: |
        mkdir buildinfo
        mkdir package
        mkdir targets
        echo "buildinfo" > ./buildinfo/build
        echo "package" > ./package/pack
        echo "targets" > ./targets/tar

     
    - name: Deliver buildinfo
      uses: actions/upload-artifact@v2
      with:
        name: OpenWrt_buildinfo
        path: ./buildinfo/

    - name: Deliver package
      uses: actions/upload-artifact@v2
      with:
        name: OpenWrt_package
        path: ./package/

    - name: Deliver firmware
      uses: actions/upload-artifact@v2
      with:
        name: OpenWrt_firmware
        path: ./targets/
  

    - name: Upload release asset
      if: github.event == 'release'
      uses: svenstaro/upload-release-action@v2
      with:
        repo_token: ${{ secrets.YOURTOKEN }}
        file: ./artifact/firmware/*
        tag: ${{ github.ref }}
        file_glob: true
        
          
